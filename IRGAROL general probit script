IRGAROL_dat<-read_excel("G2_data_TD_ecotox_microbienne_2023(1).xlsx",  
                        sheet = 2)

# Extraire les noms des colonnes de temps (4 à 37)
time_labels <- colnames(IRGAROL_dat)[3:37]

# Étape 1: Créer un dataframe vide pour stocker les nouvelles données
IRGAROL_mortality_long <- data.frame(
  id = integer(),
  time = character(),
  mortality = numeric()
)

# Étape 2: Boucler sur chaque échantillon (chaque ligne) et sur chaque temps (colonnes 4 à 37)
for (i in 1:nrow(IRGAROL_dat)) {
  # Concentration initiale (t0) pour cet échantillon
  concentration_initiale <- IRGAROL_dat[i, 3]
  
  # Boucler sur les colonnes de temps (4 à 37)
  for (j in 3:ncol(IRGAROL_dat)) {
    # Calculer la mortalité à chaque temps
    mortality_value <- (concentration_initiale - IRGAROL_dat[i, j]) / concentration_initiale
    
    
    # Ajouter une nouvelle ligne au dataframe
    IRGAROL_mortality_long <- rbind(
      IRGAROL_mortality_long,
      data.frame(
        id = IRGAROL_dat[i, 2],       # L'identifiant de l'échantillon
        time = time_labels[j - 2],    # Le nom de la colonne (intitulé de temps)
        mortality = mortality_value    # La mortalité calculée
      )
    )
  }
}

# Remplacer toutes les valeurs négatives de la colonne 'mortality' par 0
IRGAROL_mortality_long$X0[IRGAROL_mortality_long$X0 <= 0] <- 0.001
IRGAROL_mortality_long$X0[IRGAROL_mortality_long$X0 == 1] <- 0.999

# Vérifier les premières lignes après la modification
head(IRGAROL_mortality_long)


# Appliquer la transformation probit sur la mortalité
IRGAROL_mortality_long$probit <- qnorm(IRGAROL_mortality_long$X0) +5

IRGAROL_mortality_long$concentration <- 0
for (i in 1:nrow(IRGAROL_mortality_long)){
  if (IRGAROL_mortality_long$Designation[i] == "I 0,125") {
    IRGAROL_mortality_long$concentration[i] <- 0.125
  }
  if (IRGAROL_mortality_long$Designation[i] == "I 0,25") {
    IRGAROL_mortality_long$concentration[i] <- 0.25
  }
  if (IRGAROL_mortality_long$Designation[i] == "I 0,5") {
    IRGAROL_mortality_long$concentration[i] <- 0.5
  }
  if (IRGAROL_mortality_long$Designation[i] == "I 1") {
    IRGAROL_mortality_long$concentration[i] <- 1
  }
  if (IRGAROL_mortality_long$Designation[i] == "I 2") {
    IRGAROL_mortality_long$concentration[i] <- 2
  }
  if (IRGAROL_mortality_long$Designation[i] == "I 4") {
    IRGAROL_mortality_long$concentration[i] <- 4
  }
  if (IRGAROL_mortality_long$Designation[i] == "I 8") {
    IRGAROL_mortality_long$concentration[i] <- 8
  }
  if (IRGAROL_mortality_long$Designation[i] == "I 16") {
    IRGAROL_mortality_long$concentration[i] <- 16
  }

}
